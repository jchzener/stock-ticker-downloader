name: Update Stock Tickers Daily

# Déclencheur : Ce workflow s'exécute tous les jours à 00:00 UTC
# (Vous pouvez ajuster l'horaire selon vos besoins)
on:
  schedule:
    # Utilisez un cron standard pour planifier l'exécution
    # Cette ligne signifie : "À 00:00 (minuit) chaque jour"
    - cron: "0 0 * * *"
  # Permet également de déclencher manuellement le workflow depuis l'onglet "Actions" de GitHub
  workflow_dispatch:

# Job : Ensemble de tâches à effectuer
jobs:
  update-tickers:
    # Sur quelle machine virtuelle exécuter le job
    runs-on: ubuntu-latest

    # Étapes du job
    steps:
      # 1. Récupérer le code source de votre dépôt
      - name: Checkout repository
        uses: actions/checkout@v4 # Utilisez la dernière version majeure
        with:
          # Ceci est crucial : permet de pousser les changements ensuite
          token: ${{ secrets.GITHUB_TOKEN }}

      # 2. Installer Python sur la VM
      - name: Set up Python
        uses: actions/setup-python@v5 # Utilisez la dernière version majeure
        with:
          python-version: "3.x" # Utilisez la version de Python souhaitée, 3.x est généralement bon

      # 3. Installer les dépendances Python (requests)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt # Si vous avez un fichier requirements.txt
          # OU
          pip install requests # Installer directement requests si pas de fichier requirements

      # 4. Run the script
      - name: Run Stock Ticker Downloader
        run: |
          python -m stock_ticker_downloader.downloader # Exécute le module comme un script

      # 5.push on the repo
      - name: Commit and push if changed
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          # Ajoute tous les fichiers modifiés dans le répertoire stock_data/
          git add stock_data/
          # Vérifie si des fichiers ont été modifiés
          if git diff --staged --quiet; then
            echo "No changes to commit."
          else
            git commit -m "Automated update: Refresh stock tickers [skip ci]" # [skip ci] évite une boucle infinie
            git push
            echo "Changes committed and pushed."
          fi
