name: Update Stock Tickers Daily

# Déclencheur : Ce workflow s'exécute tous les jours à 00:00 UTC
# (Vous pouvez ajuster l'horaire selon vos besoins)
on:
  schedule:
    # Utilisez un cron standard pour planifier l'exécution
    # Cette ligne signifie : "À 00:00 (minuit) chaque jour"
    - cron: "0 0 * * *"
  # Permet également de déclencher manuellement le workflow depuis l'onglet "Actions" de GitHub
  workflow_dispatch:

# Job : Ensemble de tâches à effectuer
jobs:
  update-tickers:
    # Sur quelle machine virtuelle exécuter le job
    runs-on: ubuntu-latest

    # J0B
    steps:
      # 1. Code
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # Ceci est crucial : permet de pousser les changements ensuite
          token: ${{ secrets.GITHUB_TOKEN }}

      # 2. Python run time env
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.9.12"

      # 3. pip install
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt 
          # or
          pip install requests

      # 4. Run the script
      - name: Run Stock Ticker Downloader
        run: |
          python -m stock_ticker_downloader.downloader

      # 5.push on the repo
      - name: Commit and push if changed
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          # Ajoute tous les fichiers modifiés dans le répertoire active_tickers/
          git add active_tickers/
          # check modifications
          if git diff --staged --quiet; then
            echo "No changes to commit."
          else
            git commit -m "Automated update: Refresh stock tickers [skip ci]" # [skip ci] prevent infinite loop
            git push
            echo "Changes committed and pushed."
          fi
